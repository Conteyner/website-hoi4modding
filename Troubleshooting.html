<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="stylesheet" href="style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <div class="header">
    <A href="index.html"><button id="leftButton"> <span>Назад</span>
      </button></A>
    <a href="https://discord.gg/east-showdown-1024735523589324830"><img class="icon" id="discord-icon" src="discord.png"
        alt="Дискорд"></a>
    <a href="https://github.com/Conteyner/website-hoi4modding"><img class="icon" id="github-icon" src="github.png"
        alt="Гитхаб"></a>

  </div>
  <h1>Список имен</h1>
  <div id="table-of-contents">
    <h2>Содержание</h2>
    <ul>
      <li><a href="#section1">Обзор</a>
      </li>
    </ul>
    <ul>
      <li>
        <a href="#section2">Тестирование</a>
      </li>
    </ul>

    <ul>
      <li>
        <a href="#section3">Файлы журналов</a>
      </li>
    </ul>
    <ul>
      <li>
        <a href="#section4">Error лог</a>
      </li>
    </ul>

    <ul>
      <li>
        <a href="#section5">Общие причины крашей</a>
      </li>
    </ul>
    <ul>
      <li>
        <a href="#section6">Загрузка главного меню</a>
      </li>
    </ul>
    <ul>
      <li>
        <a href="#section7">Во время выбора страны</a>
      </li>
    </ul>
    <ul>
      <li>
        <a href="#section8">В середине игры</a>
      </li>
    </ul>
    <ul>
      <li>
        <a href="#section9">Дополнительные сведения</a>
      </li>
    </ul>
  </div>

  <div class="block">
    <h2 id="section1">Обзор</h2>
    <p>
      В целом, существует два вида ошибок: фатальные и нефатальные. <br><br>

      Фатальные ошибки возникают, когда игра не может загрузить жизненно важный фрагмент данных и не может работать без
      него. Это приводит к выходу на рабочий стол (CTD).

      Когда возникают фатальные ошибки, исключение будет выведено в журнал exceptions.log. Обычно такие ошибки возникают
      в
      процессе загрузки или при выполнении определенного действия в игре. <br><br>

      Нефатальные ошибки возникают, когда игра встречает недопустимые данные или нарушенный синтаксис. Эти ошибки почти
      всегда печатаются в error.log.
    </p>
  </div>

  <div class="block">
    <h2 id="section2">Тестирование</h2>
    <p>
      Проведение тестирования жизненно важно для отладки мода. Обычно это делается через игровую консоль с помощью
      команд. <br> <br>

      Вот полезные консольные команды:
    </p>
    <table>
      <tr>
        <th>Команда</th>
        <th>Использование</th>
      </tr>
      <tr>
        <td>reloadfx all</td>
        <td>Перезагружает большинство эффектов, используемых в игре, таких как туман войны, HDR и непрозрачность границ
          стран и так далее.</td>
      </tr>
      <tr>
        <td>reload texture</td>
        <td>Перезагружает большинство текстур, используемых в игре, таких как портреты лидеров, иконки технологий и так
          далее.</td>
      </tr>
      <tr>
        <td>reload localization</td>
        <td>Перезагружает большинство локализаций, используемых в игре, таких как названия и описания событий.</td>
      </tr>
      <tr>
        <td>reload defines</td>
        <td>Перезагружает файлы defines из / Hearts of Iron IV / common / defines /.</td>
      </tr>
      <tr>
        <td>reload focus</td>
        <td>Перезагружает деревья фокусов в / Hearts of Iron IV / common / national_focuses /.</td>
      </tr>
      <tr>
        <td>reloadoob</td>
        <td>Перезагружает файл начальной организации для указанной тега.</td>
      </tr>
      <tr>
        <td>reloadtechnologies</td>
        <td>Перезагружает файлы технологий. Будет вызывать сбой, если произойдет ошибка.</td>
      </tr>
      <tr>
        <td>reloadinterface</td>
        <td>Перезагружает файлы интерфейса (.gui).</td>
      </tr>
      <tr>
        <td>reload decision</td>
        <td>Перезагружает файлы решений (.gui и common / decisions).</td>
      </tr>
      <tr>
        <td>tdebug</td>
        <td>Активирует всплывающие подсказки отладки, отображающие важную информацию, такую как ID состояния, ID
          провинции и т.д.</td>
      </tr>
      <tr>
        <td>event</td>
        <td>Запускает указанное событие немедленно для страны текущего игрока.</td>
      </tr>
      <tr>
        <td>nocb</td>
        <td>Убирает ограничения на дипломатические действия.</td>
      </tr>
      <tr>
        <td>observe</td>
        <td>Помещает игрока в слот наблюдателя, позволяя игре продолжаться без ввода игрока.</td>
      </tr>
      <td>aiview</td>
      <td>Отображает приоритеты искусственного интеллекта при наведении на конкретные кнопки, такие как технологии.</td>
      </tr>
      <tr>
        <td>tag</td>
        <td>Переключает игрока на другую страну.</td>
      </tr>
      <tr>
        <td>update_loc</td>
        <td>Перезагружает указанный ключ локализации.</td>
      </tr>
      <tr>
        <td>updateequipments</td>
        <td>Перезагружает файлы оборудования в /Hearts of Iron IV/common/units/equipment/.</td>
      </tr>
      <tr>
        <td>updatesubunits</td>
        <td>Перезагружает файлы подразделений в /Hearts of Iron IV/common/units/.</td>
      </tr>
      <tr>
        <td>research_on_icon_click</td>
        <td>Активирует исследование при нажатии, позволяя щелкнуть по технологиям, чтобы мгновенно их исследовать.</td>
      </tr>
      <tr>
        <td>Focus.NoChecks</td>
        <td>Удаляет проверки триггера для фокусов.</td>
      </tr>
      <tr>
        <td>Focus.AutoComplete</td>
        <td>Активирует мгновенное завершение фокусов.</td>
      </tr>
      <tr>
        <td>set_country_flag</td>
        <td>Устанавливает указанный флаг страны для текущей страны.</td>
      </tr>
      <tr>
        <td>add_ideas</td>
        <td>Добавляет указанную идею в текущую страну.</td>
      </tr>
    </table>
  </div>

  <div class="block">
    <h2 id="section3">Файлы журналов</h2>
    <p>
      Игра хранит различные файлы журналов в вашей пользовательской папке HOI4: <i>(Windows: \\\Documents\Paradox
        Interactive\Hearts of Iron IV\logs\, Linux:
        .local/share/Paradox Interactive/Hearts of Iron IV/logs)</i>. Они перезаписываются при каждом запуске игры. <br>

      Чтобы включить полное протоколирование ошибок, добавьте команду запуска <i>-debug</i> через Set Launch Options в
      Steam.
    </p>

    <table>
      <tr>
        <th>Файл</th>
        <th>Описание</th>
        <th>Полезность</th>
      </tr>
      <tr>
        <td>ai.log</td>
        <td>Выводит выбранные ИИ-решения</td>
        <td>Средняя</td>
      </tr>
      <tr>
        <td>ai_trace.log</td>
        <td>Выводит ИИ-движения (подразделения, корабли, воздушные силы и т. д.)</td>
        <td>Низкая</td>
      </tr>
      <tr>
        <td>error.log</td>
        <td>Выводит различные нефатальные ошибки. Многие ошибки можно игнорировать, хотя практически все ошибки,
          относящиеся к файлам в папке common, следует исправлять</td>
        <td>Высокая</td>
      </tr>
      <tr>
        <td>exceptions.log</td>
        <td>Выводит стек вызовов при падении игры до рабочего стола</td>
        <td>Низкая</td>
      </tr>
      <tr>
        <td>executedcommands.log</td>
        <td>Выводит внутренние команды, используемые игроком и ИИ</td>
        <td>Низкая</td>
      </tr>
      <tr>
        <td>game.log</td>
        <td>Выводит действия, совершенные странами в игре. Полезно, когда сбой вызван конкретным действием</td>
        <td>Высокая</td>
      </tr>
      <tr>
        <td>graphics.log</td>
        <td>Выводит графические ошибки, связанные с позициями, реками и деревьями</td>
        <td>Низкая</td>
      </tr>
      <tr>
        <td>memory.log</td>
        <td>Выводит использование памяти во время установки. Полезно для сбоев во время процесса загрузки, чтобы узнать,
          когда произошел сбой</td>
        <td>Высокая</td>
      </tr>
      <tr>
        <td>message.log</td>
        <td>Выводит информацию о сессии текущей игры.</td>
        <td>Низкий</td>
      </tr>
      <tr>
        <td>postedcommands.log</td>
        <td>Выводит информацию о командах, отправленных сервером в многопользовательской игре.</td>
        <td>Низкий</td>
      </tr>
      <tr>
        <td>random.log</td>
        <td>Выводит времена изменения состояния игры.</td>
        <td>Низкий</td>
      </tr>
      <tr>
        <td>receivedcommands.log</td>
        <td>Выводит информацию о внутренних командах, полученных игроком в многопользовательской игре.</td>
        <td>Низкий</td>
      </tr>
      <tr>
        <td>sentcommands.log</td>
        <td>Выводит информацию о внутренних командах, отправленных игроком в многопользовательской игре.</td>
        <td>Низкий</td>
      </tr>
      <tr>
        <td>setup.log</td>
        <td>Выводит информацию о завершении загрузки настроек для каждой части процесса. Очень полезно для определения
          файла, который может вызывать ошибку.</td>
        <td>Высокий</td>
      </tr>
      <tr>
        <td>system.log</td>
        <td>Выводит информацию о системе, на которой запущена игра HOI4.</td>
        <td>Низкий</td>
      </tr>
      <tr>
        <td>system_debug.log</td>
        <td>Выводит ошибки интерфейса.</td>
        <td>Средний</td>
      </tr>
      <tr>
        <td>text.log</td>
        <td>Выводит assert-сообщения для ключей локализации.</td>
        <td>Средний</td>
      </tr>
      <tr>
        <td>time.log</td>
        <td>Выводит время, затраченное на различные этапы загрузки, и интервал тиков. Очень полезно для обнаружения
          сбоев в процессе загрузки, чтобы узнать, когда произошел сбой.</td>
        <td>Средний</td>
      </tr>
      </tbody>
    </table>

  </div>
  <h1 id="section4">Error лог</h1>
  <div class="block">

    <p>
      Когда игра терпит крах, она предоставляет информацию о системных настройках и о том, что вызвало крах, в папке<i>
        /Hearts of Iron IV/crashes/</i> каталога пользователя. Хотя в большинстве случаев это не помогает
      определить причину сбоя, журнал ошибок может содержать подсказки. Однако один важный механизм ведения журнала
      можно включить дополнительно:
    </p>

    <p>
      Добавление команды запуска <i>-crash_data_log</i> через Launch Options в Steam также заставит файл meta.yml в этой
      папке (непосредственно в ней, а не в подпапке /logs/)
      содержать последнюю прочитанную строку кода перед крахом, а также включит режим отладки. Это замедляет игру на
      значительную величину,
      поэтому не должно использоваться вне режима отладки. Если последняя прочитанная строка указанного файла является
      последней строкой в файле, скорее всего,
      игра потерпела крах на следующем прочитанном файле,
      который довольно трудно обнаружить. В некоторых случаях игра может выдать скрипт вместо файла, например, savefile
      или client_ping.
    </p>
    <p>
      Это может выглядеть как <i>LastRead: map/supply_nodes.txt (727) </i>
      (где число обозначает строку файла, которая была прочитана последней перед тем, как произошел сбой) или LastRead:
      client_ping (1).
    </p>
    <p>
      Обратите внимание, что хотя -crash_data_log включает режим отладки, не все преимущества
      опции запуска применяются по умолчанию и требуют использования обеих опций запуска. Например, правки файлов,
      проиндексированных во время загрузки главного меню,
      не будут автоматически загружены, вместо этого потребуется использование консольной команды для перезагрузки.
      Однако отладка -crash_data_log включает загрузку игры в главное меню
      с ошибками карты, доступность подталкивания для выбора и отладочную информацию при наведении курсора на провинцию
      или страну.
    </p>
  </div>
  <h1 id="section5">Общие причины крашей</h1>
  <div class="block">
    <P>
      Различные типы аварий вызваны бездумной выгрузкой папок с помощью replace_path, в результате чего игра
      обнаруживает, что в базе данных нет записей определенного типа. По этой причине, а также во избежание
      неинтуитивных ошибок, лучше всего переносить общие файлы в мод, если вы полностью перезаписываете папку.
    </P>
    <p>
      В случае другого сбоя, обратите внимание, что если файл полностью пуст, игра может пропустить его полное чтение.
      Таким образом, при одном и том же сбое может отображаться другой файл, если тот, что указан в этом списке, пуст.
      Лучше всего полностью очистить журнал ошибок, прежде чем пытаться найти ошибку, так как некоторые ошибки могут
      казаться безобидными, но при этом приводить к краху игры.
    </p>
    <p>
      Если последний прочитанный файл окажется бесполезным, можно временно удалить файлы из мода и медленно добавлять их
      заново,
      чтобы найти точную причину; после нахождения папки с причиной, она должна быть соответствующим образом
      скорректирована.
      Можно использовать своего рода бинарный поиск, добавляя/удаляя файлы большими кусками за раз. Пути replace_paths
      могут быть удалены, кроме основных: <i>history/states/ </i>
      и <i>map/strategicregions</i>. Обратите внимание, что оба *.mod файла должны быть отредактированы для применения
      replace_paths.
    </p>
    <p>
      Этот список не является исчерпывающим: Существует больше потенциальных сбоев, и каждый конкретный файл или скрипт
      может иметь больше причин, которые не указаны в этом списке.
      Для удобства навигации список разбит на разделы по времени возникновения.
      Представленный файл - это файл, отмеченный как последний прочитанный в журнале данных о сбоях.
    </p>

    <h2 id="section6">Загрузка главного меню</h2>
    <p>

      <i>common/countries/cosmetic.txt</i> - Вызвано полной перезаписью файла <i>common/national_focus/</i> или
      <i>common/continuous_focus/</i>.

    </p>

    <p>
      <i>map/rocketsites.txt</i> - Вызвано полной перезаписью <i>history/states/</i> или <i>common/unit_leader/</i> .
      Поскольку "общих файлов"
      для государств не существует, вместо них следует создать один вручную.
    </p>
    <p>
      <i>common/national_focus/*.txt</i> - Этот сбой, учитывая, что это последняя строка последнего файла в папке,
      может быть вызван деревом фокусов с использованием аргумента shared_focus = my_focus, указывающего несуществующий
      общий фокус.
    </p>
    <p>
      <i>gfx/models/supply/railroad.shader</i> - Причина ошибки в файлах .bmp, создающих карту.
      Это может быть вызвано самыми разными причинами. Некоторые причины: provinces.bmp имеет размеры в виде чисел, не
      делимых на 256,
      размер более 40 MiB, размеры меняются между различными растровыми картами (кроме trees.bmp, где размер меняется в
      зависимости от плотности статических моделей),
      или неправильное форматирование
      заголовка DIB (например, установка кодировки для использования или использование BITMAPV5HEADER вместо
      BITMAPINFOHEADER) в любой растровой карте.
    </p>
    <p>
      <i>history/general/*.txt</i> <i>/ history/countries/*.txt</i> <i>/ map/rocketsites.txt</i> (В порядке их появления
      с заменой_путей на предыдущие) -
      В одном из государств внутри мода есть определение <i>victory_points = { .... }</i> определение, которое пытается
      присвоить победные очки провинции, не существующей в игре.
    </p>


    <h2 id="section7">Во время выбора страны</h2>
    <p>
      Сюда же относится загрузка после того, как страна выбрана, но играть еще нельзя. </p>
    <p>
      set_controller - Этот сбой обычно происходит при попытке выбрать страну в закладке, если у страны нет допустимой
      столицы, определенной в файле /Hearts of Iron IV/history/countries/TAG*.txt. Игра использует столицу, чтобы
      определить, на какую часть карты нужно увеличить масштаб, и отсутствие столицы является неожиданностью. <br>
      savegame.hoi4 (принимает имя файла сохранения, не обязательно существующего в данный момент) - Вызвано тем, что в
      игре определено большое количество стран без динамических стран. Точное количество стран, которое может обработать
      игра, не является постоянным числом, обычно оно находится в диапазоне 40-80. Обычно вызвано бездумной перезаписью
      тегов common/country_tags.<br>
      history/units/filename.txt - В одном из морских боевых порядков в моде определен авианосец с крыльями прямо
      внутри, как это было сделано в 1.11 и более ранних версиях. Отрегулируйте боевые порядки в моде по мере
      необходимости. Обратите внимание, что файл, показанный как последний прочитанный, не обязательно является тем,
      который выводит игру из строя.<br>
      history/units/filename.txt / map/railways.txt - Вызвано тем, что страна имеет шаблон дивизии, но не находит ни
      одной возможной записи /Hearts of Iron IV/common/ai_templates, которую можно использовать для расширения шаблона.
      Точный файл/скрипт зависит от того, когда страна получила шаблон дивизии: боевой приказ (который будет прочитан
      последним) или другой файл истории (ведущий к железным дорогам).<br>
      map/supply_nodes.txt или map/railways.txt - Этот сбой чаще всего вызван тем, что указанные типы зданий размещаются
      на недействительных провинциях, например, на тех, которые не расположены в штатах. Этот сбой происходит как при
      попытке открыть меню снабжения в nudge, так и при попытке начать одиночную игру. Это можно исправить, очистив
      соответствующие файлы и, по желанию, создав правильное определение файлов, вручную или через nudge.<br>
      tutorial/tutorial.txt - Этот сбой вызван тем, что файл учебника является ошибочным. Это может быть представлено
      как ссылка на неверный идентификатор состояния в файле (например, если все базовые игры были стерты) или как
      отсутствие в файле определения tutorial = { ... } определения любого типа. Замена всего содержимого файла на
      tutorial = { } приводит к устранению сбоя.

      Это также последний файл, который считывается после завершения процесса выбора страны. Если сразу после этого
      произойдет сбой и игра не сможет правильно записать файл, он попадет в этот файл.
    </p>

    <h2 id="section8">В середине игры</h2>
    <p>
      client_ping или hourly_tick - Этот сбой вызван внутриигровым ИИ,
      что можно увидеть, отключив ИИ с помощью консоли. Существует несколько причин возникновения этого сбоя, включая,
      но не ограничиваясь ими:
    </p>
    <p>
      Страна имеет шаблон дивизии, но не может найти ни одной записи /Hearts of Iron IV/common/ai_templates, которую
      можно было бы использовать для расширения шаблона.
      Обычно это вызвано бездумной перезаписью папки с помощью replace_path или ошибкой в настройке параметров
      blocked_for = { ... }/available_for = { ... } блоков.
    </p>
    <P>
      Любое состояние, у которого нет владельца, определенного в файле истории. В целом, такие государства всегда
      работают нестабильно, многие действия разрушают их, например, щелчок правой кнопкой мыши или попытка передачи
      государства стране. Одним из таких действий является попытка воздушной миссии над этим государством.
      Поскольку ИИ способен использовать самолеты, он попытается хотя бы оценить ценность выполнения миссии над этим
      государством, что приведет к выходу на рабочий стол.
    </P>
    <p>
      Неполный файл map/buildings.txt. Файл зданий, наряду с моделями зданий, также используется для определения того, в
      какую морскую провинцию выходят военно-морские базы и плавучие гавани. Эта информация необходима при попытке
      использовать любую военно-морскую базу или плавучую гавань, так как в противном случае игра не будет знать, через
      какую провинцию провинция соединяется с морем. Игра также проверяет эту информацию при попытке построить
      военно-морскую базу, и если игра пытается оценить неверное определение военно-морской базы,
      игра застревает в бесконечном цикле попыток получить информацию о военно-морской базе, что приводит к перегрузке
      CPU/GPU и краху игры.
    </p>
    <p>
      Игра может не генерировать плавучие гавани при одновременной проверке всех штатов, поэтому может потребоваться
      проверка каждого штата по отдельности. Сравнение количества совпадений для naval_base (обычно генерируется) и
      floating_harbor в файле может сообщить о наличии проблемы в моде, но не сказать, где именно. Есть несколько
      способов найти, какие именно состояния нужно обновить, если проблема действительно присутствует. Например, можно
      использовать регулярные выражения, которые поддерживаются в любом продвинутом текстовом редакторе, таком как
      Notepad++, Sublime Text и Visual Studio Code.
      Включение регулярного выражения - это отдельная опция в меню поиска и замены, поэтому ее необходимо включить
      вручную.
    </p>
    <p>
      Скопируйте файл map/buildings.txt и работайте с этой копией, поскольку этот процесс является разрушительным.
      Прежде всего, можно удалить все не относящиеся к делу строки. Это можно сделать, заменив
      ^\d*;(?!(naval_base|floating_harbor)).*(\r\n|\Z) на пустую строку
      (или $1, если текстовый редактор этого не поддерживает). После этого замена
      ^(\d+;)naval_base(.*)\r\n(?s)(.*)(?-s)^\1floating_harbor.*\r\n на $3 удалит
      пару плавучих гаваней и военно-морских баз в пределах одного государства, однако это может удалить только 2 строки
      за раз после первых нескольких начальных замен.
      Чтобы ускорить замену строк, можно записать макрос, который выполняет этот запрос на замену несколько раз, и этот
      макрос будет воспроизводиться сам.
      Notepad++ поддерживает выполнение макроса несколько раз подряд, что можно использовать здесь для мгновенного
      запуска макроса несколько сотен или тысяч раз.
      Если после этого все еще остаются пары, поменяйте порядок военно-морских баз и плавучих гаваней с помощью
      ^(\d+;)floating_harbor(.*)\r\n(?s)(.*)(?-s)^\1naval_base.*\r\n,
      чтобы обнаружить все плавучие гавани, за которыми следуют военно-морские базы в том же состоянии, а не наоборот.
      Все строки, которые останутся после этого, будут определениями
      военно-морских баз, которые не имеют соответствующих определений в плавучих гаванях или наоборот. Например, если
      есть 3 военно-морские базы в штате 123 и 2 плавучие гавани,
      останется 1 определение военно-морской базы в штате 123. Это можно использовать в рамках подталкивания для
      проверки соответствующих штатов по отдельности.
    </p>


  </div>


  <h1 id="section9">В середине игры</h1>
  <div class="block">

    <p>
      Для отслеживания обновлений кода можно использовать сайт отслеживания версий, например [Gitlab] или [Github].
      Поэтому может быть полезно использовать их и регулярно отправлять туда обновления мода,
      чтобы ограничить выбор возможных проблемных файлов при попытке отладить проблему.

      Когда в игре происходит крупное обновление, бывает важно прочитать примечания к патчу,
      чтобы исправить вновь появившиеся ошибки. Например, в патч-нотах к версии 1.12 есть раздел "Важные замечания по
      моддингу", который также служит контрольным списком необходимых вещей, которые нужно исправить в моде, чтобы
      избежать сбоя. Также важно избегать перезаписи большинства файлов базовой игры, когда это возможно, чтобы
      облегчить совместимость, хотя это не всегда возможно. Одна из папок, где это невероятно важно делать, - defines,
      где файл переопределения является обязательным, чтобы даже незначительные обновления игры не приводили к сбоям.

      В случае если игра падает при запуске, но в журнале ошибок нет очевидной причины, и неизвестно, что было
      изменено с момента последнего обновления, мод может иметь стратегически важные папки. Например, почти всегда можно
      удалить всю папку
      /Hearts of Iron IV/common/ из мода без сбоев игры, если включен режим отладки и нет replace_paths к папке.
    </p>
  </div>

  <footer>
    <div class="footer-content">
      <p>Сайт создан conteynerrrr#0944 при поддержке<span class="footer-highlight"> East Showdown Team</span></p>
    </div>
  </footer>


</body>

</html>